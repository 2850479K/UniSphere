{% extends 'base.html' %}

{% block title %}{{ society.society_name }} Members{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
        <h2 class="mb-2">
            {{ society.society_name }} Members
            <span class="badge bg-secondary">{{ members|length }}</span>
        </h2>

        {% if user.is_authenticated and user.role == 'student' %}
        <form method="POST" class="ms-2" data-bs-toggle="tooltip" title="{% if is_member %}Click to leave this society{% else %}Click to join this society{% endif %}">
            {% csrf_token %}
            {% if is_member %}
                <button type="submit" name="action" value="leave" class="btn btn-outline-danger">
                    <i class="bi bi-box-arrow-left me-1"></i> Leave Society
                </button>
            {% else %}
                <button type="submit" name="action" value="join" class="btn btn-success">
                    <i class="bi bi-plus-circle me-1"></i> Join Society
                </button>
            {% endif %}
        </form>
        {% endif %}
    </div>

    {% if members %}
    <div class="row">
        {% for member in members %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <img src="{{ member.get_profile_picture_url }}" alt="Profile Picture" class="rounded-circle mb-3" width="80" height="80">
                    <h5 class="card-title mb-1">{{ member.full_name|default:member.user.username }}</h5>
                    <p class="card-text text-muted mb-1">
                        <i class="bi bi-mortarboard-fill me-1"></i><strong>School:</strong> {{ member.school|default:"N/A" }}
                    </p>
                    <p class="card-text text-muted">
                        <i class="bi bi-tools me-1"></i><strong>Skills:</strong> {{ member.skills|default:"N/A" }}
                    </p>
                    <a href="{% url 'profile' member.user.username %}" class="btn btn-outline-primary btn-sm mt-2">
                        <i class="bi bi-person-circle me-1"></i> View Profile
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
        <p>No members have joined this society yet.</p>
    {% endif %}
</div>

<script>
    // Enable tooltips
    document.addEventListener("DOMContentLoaded", function () {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.forEach(function (tooltipTriggerEl) {
            new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
{% endblock %}